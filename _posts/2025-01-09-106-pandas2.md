---
title: 1차시 6(빅데이터 분석):Pandas 2
layout: single
classes: wide
categories:
  - Pandas
toc: true # 이 포스트에서 목차를 활성화
toc_sticky: true # 목차를 고정할지 여부 (선택 사항)
---

## 2. Pandas 그래프 기능 가이드 및 예제

### 📌 **Seaborn , pandas , matplotlib: 어떤 걸 선택해야 할까?**

| **기능**               | **pandas `plot()`** | **matplotlib** | **Seaborn**                |
|------------------------|---------------------|----------------|----------------------------|
| **간단한 플롯**        | ⭐⭐⭐ (최적)       | ⭐⭐           | ⭐⭐                       |
| **통계 그래프**        | ❌                  | ⭐ (수동 구현) | ⭐⭐⭐ (회귀선, 분포 등 자동) |
| **다변량 데이터**      | ❌                  | ⭐⭐           | ⭐⭐⭐ (pairplot, heatmap)   |
| **카테고리 데이터**    | ⭐ (기본 막대 그래프)| ⭐⭐           | ⭐⭐⭐ (swarmplot, boxplot)  |
| **커스터마이징**       | ⭐ (제한적)         | ⭐⭐⭐ (완전 제어)| ⭐⭐ (matplotlib 기반 확장) |


### 2.1 Pandas Plotting이란?

Pandas는 Matplotlib을 백엔드로 사용하여 DataFrame과 Series에서 직접 그래프를 그릴 수 있는 편리한 기능을 제공합니다. 별도의 복잡한 설정 없이 간단한 메서드 체이닝으로 시각화가 가능합니다.

Pandas Plotting의 주요 장점:
  - **간편함**: `.plot()` 메서드 하나로 다양한 그래프 생성
  - **DataFrame 친화적**: 인덱스와 컬럼을 자동으로 축 레이블로 사용
  - **빠른 데이터 탐색**: EDA(탐색적 데이터 분석)에 최적
  - **Matplotlib 통합**: Matplotlib의 모든 기능을 그대로 활용 가능

### 2.2 기본 설정

```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# 한글 폰트 설정 (선택사항)
plt.rcParams['font.family'] = 'DejaVu Sans'
plt.rcParams['axes.unicode_minus'] = False
```

### 2.3 기본 플롯 유형 및 예제

**1. 선 그래프 (Line Plot)**
* pandas의 df.plot()에서 x축은 자동으로 DataFrame의 index가 됩니다
* 인덱스를 별도로 설정하지 않으면 0, 1, 2, ... 같은 정수 인덱스가 자동 할당됩니다
* plot()의 kind 기본값은 'line' 이다.
* Series객체에서도 plot()을 호출 가능. x축에 Series의 인덱스가 옴

```python
# 샘플 데이터 생성
#pd.date_range()는 DatetimeIndex 객체를 반환하지만,
#pandas DataFrame에 넣을 때는 자동으로 Series 형태로 변환

dates = pd.date_range('2023-01-01', periods=100, freq='D')
df = pd.DataFrame({
    'date': dates,
    'sales': np.random.randint(100, 500, 100),
    'profit': np.random.randint(50, 200, 100)
})
df.set_index('date', inplace=True) 


# 기본 선 그래프
df['sales'].plot() 
plt.title('일별 매출')
plt.ylabel('매출')
plt.show()

# 여러 컬럼을 한번에
df.plot()
plt.title('매출과 수익 추이')
plt.ylabel('금액')
plt.show()

# 스타일링
df.plot(color=['blue', 'red'], linewidth=2, linestyle='--')
plt.title('스타일링된 그래프')
plt.show()
```

**2. 막대 그래프 (Bar Plot)**

```python
# 범주형 데이터 생성
categories = pd.DataFrame({
    'product': ['A', 'B', 'C', 'D', 'E'],
    'sales_q1': [100, 150, 200, 120, 180],
    'sales_q2': [120, 130, 220, 140, 190]
})
categories.set_index('product', inplace=True)

# 세로 막대 그래프
categories.plot(kind='bar')
plt.title('제품별 분기 매출')
plt.ylabel('매출')
plt.xticks(rotation=0)
plt.show()

# 가로 막대 그래프
categories.plot(kind='barh')
plt.title('제품별 분기 매출 (가로)')
plt.xlabel('매출')
plt.show()

# 누적 막대 그래프
categories.plot(kind='bar', stacked=True)
plt.title('제품별 누적 매출')
plt.ylabel('매출')
plt.xticks(rotation=45)
plt.show()
```

**3. 히스토그램 (Histogram)**

```python
# 정규분포 데이터 생성
data = pd.DataFrame({
    'score_A': np.random.normal(75, 10, 1000),
    'score_B': np.random.normal(80, 12, 1000),
    'score_C': np.random.normal(70, 8, 1000)
})

# 단일 컬럼 히스토그램
data['score_A'].plot(kind='hist', bins=30, alpha=0.7)
plt.title('A반 점수 분포')
plt.xlabel('점수')
plt.ylabel('빈도')
plt.show()

# 여러 컬럼 히스토그램 (서브플롯)
data.plot(kind='hist', bins=20, alpha=0.7, subplots=True, layout=(2, 2), figsize=(10, 8))
plt.suptitle('반별 점수 분포')
plt.tight_layout()
plt.show()

# 동일 축에 여러 히스토그램
data.plot(kind='hist', bins=30, alpha=0.6)
plt.title('전체 반 점수 분포 비교')
plt.xlabel('점수')
plt.ylabel('빈도')
plt.show()
```

**4. 박스 플롯 (Box Plot)**

```python
# 박스 플롯
data.plot(kind='box')
plt.title('반별 점수 분포 (박스 플롯)')
plt.ylabel('점수')
plt.show()

# 수평 박스 플롯
data.plot(kind='box', vert=False)
plt.title('반별 점수 분포 (수평 박스 플롯)')
plt.xlabel('점수')
plt.show()
```

**5. 산점도 (Scatter Plot)**

```python
# 두 변수간 관계 분석
scatter_data = pd.DataFrame({
    'study_hours': np.random.uniform(1, 10, 100),
    'test_score': np.random.uniform(50, 100, 100),
    'sleep_hours': np.random.uniform(4, 9, 100)
})

# 기본 산점도
scatter_data.plot(kind='scatter', x='study_hours', y='test_score')
plt.title('공부 시간 vs 시험 점수')
plt.show()

# 크기와 색상 추가
scatter_data.plot(kind='scatter', x='study_hours', y='test_score', 
                 s=scatter_data['sleep_hours']*10, alpha=0.6)
plt.title('공부 시간 vs 시험 점수 (수면 시간을 크기로 표현)')
plt.show()

# 색상으로 구분
scatter_data.plot(kind='scatter', x='study_hours', y='test_score', 
                 c='sleep_hours', colormap='viridis')
plt.title('공부 시간 vs 시험 점수 (수면 시간별 색상)')
plt.show()
```

**6. 파이 차트 (Pie Chart)**

```python
# 파이 차트용 데이터
pie_data = pd.Series([30, 25, 20, 15, 10], 
                    index=['Python', 'Java', 'JavaScript', 'C++', 'Go'],
                    name='언어별 사용률')

# 기본 파이 차트
pie_data.plot(kind='pie')
plt.title('프로그래밍 언어 사용률')
plt.ylabel('')  # y 레이블 제거
plt.show()

# 스타일링된 파이 차트
pie_data.plot(kind='pie', autopct='%1.1f%%', startangle=90, 
             colors=['skyblue', 'lightgreen', 'lightcoral', 'gold', 'plum'])
plt.title('프로그래밍 언어 사용률')
plt.ylabel('')
plt.show()
```

**7. 영역 그래프 (Area Plot)**

```python
# 시계열 누적 영역 그래프
area_data = pd.DataFrame({
    'month': pd.date_range('2023-01-01', periods=12, freq='M'),
    'product_A': np.random.randint(50, 150, 12),
    'product_B': np.random.randint(40, 120, 12),
    'product_C': np.random.randint(30, 100, 12)
})
area_data.set_index('month', inplace=True)

# 누적 영역 그래프
area_data.plot(kind='area', stacked=True, alpha=0.7)
plt.title('월별 제품 매출 (누적)')
plt.ylabel('매출')
plt.show()

# 비누적 영역 그래프
area_data.plot(kind='area', stacked=False, alpha=0.5)
plt.title('월별 제품 매출 (비누적)')
plt.ylabel('매출')
plt.show()
```

### 2.4 고급 기능 및 사용자 정의
**1. 서브플롯 활용**

```python
# 복합 데이터
complex_data = pd.DataFrame({
    'date': pd.date_range('2023-01-01', periods=50, freq='D'),
    'temperature': np.random.normal(20, 5, 50),
    'humidity': np.random.normal(60, 10, 50),
    'pressure': np.random.normal(1013, 20, 50)
})
complex_data.set_index('date', inplace=True)

# 서브플롯으로 각각 표시
complex_data.plot(subplots=True, layout=(2, 2), figsize=(12, 8))
plt.suptitle('날씨 데이터')
plt.tight_layout()
plt.show()

# 이중 Y축 사용
ax1 = complex_data['temperature'].plot(color='red', label='온도')
ax1.set_ylabel('온도 (°C)', color='red')

ax2 = ax1.twinx()
complex_data['humidity'].plot(ax=ax2, color='blue', label='습도')
ax2.set_ylabel('습도 (%)', color='blue')

plt.title('온도와 습도')
plt.show()
```

**2. 그룹별 시각화**

```python
# 그룹 데이터 생성
group_data = pd.DataFrame({
    'category': ['A', 'B', 'C'] * 100,
    'value1': np.random.normal(100, 20, 300),
    'value2': np.random.normal(50, 15, 300),
    'month': pd.concat([pd.Series(pd.date_range('2023-01-01', periods=100, freq='D'))] * 3)
})

# 그룹별 평균값 계산 및 시각화
#행 인덱스가 month와 category 두 개로 구성된 MultiIndex
#unstack() 사용시 category가 열 (column)로 올라갔다.시각화나 비교 분석에 용이
monthly_avg = group_data.groupby(['month', 'category'])['value1'].mean().unstack()
monthly_avg.plot()
plt.title('카테고리별 월간 평균값')
plt.ylabel('평균값')
plt.show()

# 피벗 테이블 히트맵 스타일
pivot_data = group_data.pivot_table(values='value1', index='month', columns='category', aggfunc='mean')
# 주의: 판다스 plot으로는 히트맵을 직접 그릴 수 없으므로 시각화는 다른 방법 사용
```

**3. 롤링 윈도우와 함께**

```python
# 시계열 데이터
ts_data = pd.DataFrame({
    'date': pd.date_range('2023-01-01', periods=365, freq='D'),
    'value': np.random.normal(100, 20, 365) + np.sin(np.linspace(0, 4*np.pi, 365)) * 10
})
ts_data.set_index('date', inplace=True)

# 원본 데이터와 이동평균 함께 표시
# 오늘 기준으로 29일 전까지의 데이터를 포함해서 평균을 계산
ts_data['rolling_mean'] = ts_data['value'].rolling(window=30).mean()

ts_data.plot(alpha=0.7)
plt.title('원본 데이터와 30일 이동평균')
plt.ylabel('값')
plt.show()
```

### 2.5 스타일링 옵션

**1. 색상과 스타일 사용자 정의**

```python
# 다양한 스타일 옵션
# 길이 50의 정규분포 난수를 생성하고, 이 수들의 누적합 (cumulative sum)을 구한다.
# 결과적으로 랜덤 워크 (Random Walk)처럼 보이는 시계열 데이터가 됩니다.
style_data = pd.DataFrame({
    'A': np.random.randn(50).cumsum(), 
    'B': np.random.randn(50).cumsum(),
    'C': np.random.randn(50).cumsum()
})

# 색상 지정
style_data.plot(color=['red', 'green', 'blue'], linewidth=2)
plt.title('색상 지정')
plt.show()

# 선 스타일 지정
style_data.plot(style=['--', ':', '-.'], linewidth=2)
plt.title('선 스타일 지정')
plt.show()

# 마커 추가
style_data.plot(marker='o', markersize=3, alpha=0.7)
plt.title('마커 추가')
plt.show()
```

**2. 테마 적용**

```python
# matplotlib 스타일과 함께 사용
plt.style.use('seaborn-v0_8')  # 또는 'ggplot', 'dark_background' 등

style_data.plot()
plt.title('Seaborn 스타일 적용')
plt.show()

# 기본 스타일로 복원
plt.style.use('default')
```

### 2.6 실무 활용 예제

**1. 데이터 탐색 (EDA)**

```python
# 실무 데이터 시뮬레이션
sales_data = pd.DataFrame({
    'date': pd.date_range('2023-01-01', periods=365, freq='D'),
    'sales': np.random.poisson(100, 365) + np.sin(np.linspace(0, 4*np.pi, 365)) * 20, #판매량이 주기적으로 ±20만큼 변동
    'customers': np.random.poisson(50, 365) + np.sin(np.linspace(0, 4*np.pi, 365)) * 10,
    'avg_order': np.random.normal(80, 15, 365)
})
sales_data.set_index('date', inplace=True)

# 빠른 데이터 탐색
# axes는(2,2) 2차원 배열이므로, axes[0]이 아니라 axes[0, 0]처럼 행과 열을 모두 지정 
fig, axes = plt.subplots(2, 2, figsize=(15, 10))

# 매출 추이
sales_data['sales'].plot(ax=axes[0,0], title='일별 매출 추이')

# 고객 수 분포
sales_data['customers'].plot(kind='hist', ax=axes[0,1], bins=30, title='고객 수 분포')

# 평균 주문금액 박스플롯()
# boxplot은 DataFrame을 입력으로 받는 걸 선호하여 'avg_order'를 배열안에 둔다.
sales_data[['avg_order']].plot(kind='box', ax=axes[1,0], title='평균 주문금액')

# 매출 vs 고객 수 산점도
sales_data.plot(kind='scatter', x='customers', y='sales', ax=axes[1,1], 
               title='고객 수 vs 매출', alpha=0.6)

plt.tight_layout()
plt.show()
```

**2. 성과 대시보드**

```python
# 월별 성과 집계
monthly_performance = sales_data.resample('M').agg({
    'sales': 'sum',
    'customers': 'sum', 
    'avg_order': 'mean'
})

# 성과 대시보드
fig, axes = plt.subplots(2, 2, figsize=(15, 10))

# 월별 매출
monthly_performance['sales'].plot(kind='bar', ax=axes[0,0], color='steelblue')
axes[0,0].set_title('월별 총 매출')
# x축 레이블을 'YYYY-MM' 형식으로 변경
axes[0,0].set_xticklabels(monthly_performance.index.strftime('%Y-%m'))
axes[0,0].tick_params(axis='x', rotation=45)

# 고객 수 추이
monthly_performance['customers'].plot(ax=axes[0,1], marker='o', color='green')
axes[0,1].set_title('월별 고객 수 추이')

# 평균 주문금액 추이
monthly_performance['avg_order'].plot(ax=axes[1,0], marker='s', color='orange')
axes[1,0].set_title('월별 평균 주문금액')

# 전체 지표 비교 (정규화)
#각 열의 최대값 (max)으로 나누어 주면, 가장 큰 값은 1, 나머지는 0~1 사이가 됨
monthly_performance_norm = monthly_performance / monthly_performance.max()
monthly_performance_norm.plot(ax=axes[1,1])
axes[1,1].set_title('전체 지표 비교 (정규화)')
axes[1,1].legend(['매출', '고객 수', '평균 주문금액'])

plt.tight_layout()
plt.show()
```

**3. 상관관계 분석**

```python
# 상관관계 매트릭스 시각화 (판다스로는 제한적)
# 피어슨 상관계수 (Pearson correlation coefficient)를 기본으로 계산
#완전한 양의 상관관계, 상관관계 없음,완전한 음의 상관관계
correlation_data = sales_data.corr()
print("상관관계 매트릭스:")
print(correlation_data)

# 상관관계 산점도 매트릭스
pd.plotting.scatter_matrix(sales_data, figsize=(10, 10), diagonal='hist', alpha=0.6)
plt.suptitle('변수간 상관관계')
plt.show()
```

### 2.7 저장 및 내보내기

```python
# 그래프 저장
ax = sales_data['sales'].plot(figsize=(10, 6))
plt.title('매출 추이')
plt.ylabel('매출')

# 고해상도로 저장
# 항상 plt.show() 전에 savefig()를 호출해야
plt.savefig('sales_trend.png', dpi=300, bbox_inches='tight')
plt.savefig('sales_trend.pdf', bbox_inches='tight')
plt.show()
```

### 2.8 주요 팁과 모범 사례

```python
# 1. 체이닝을 활용한 빠른 시각화
# 체이닝 시 괄호 ()를 사용하면 여러 줄로 나눠 써도 됩니다
(sales_data
 .resample('W')
 .sum()
 ['sales']
 .plot(title='주별 매출')
)
plt.show()

# 1.2 체이닝을 활용한 빠른 시각화 + 이동평균 추가
ax = (sales_data
      .resample('W')
      .sum()
      ['sales']
      .plot(title='주별 매출과 4주 이동평균', 
            label='주별 매출', 
            legend=True)
)

(sales_data
 .resample('W')
 .sum()
 ['sales']
 .rolling(4)
 .mean()
 .plot(ax=ax, label='4주 이동평균', legend=True, linestyle='--')
)

plt.tight_layout()
plt.show()

# 2. 조건부 색상
# pandas의 plot() 함수에서 하나의 시리즈(Series)에 여러 색 적용은 지원 X
# matplotlib의 plot() 함수를 사용하는 것이 더 유연하고 정확
def color_by_value(val):
    return 'red' if val > sales_data['sales'].mean() else 'blue'

colors = [color_by_value(val) for val in sales_data['sales']]
plt.plot(sales_data.index, sales_data['sales'], color='gray', alpha=0.5, label='전체 추세')
plt.scatter(sales_data.index, sales_data['sales'], color=colors, alpha=0.7)
plt.title('평균 이상/이하 매출 구분')
plt.legend()
plt.grid(True)
plt.show()

```

### 2.9 Matplotlib vs Seaborn vs Pandas 비교

```python
# 동일한 데이터로 세 가지 방법 비교
sample_data = pd.DataFrame({
    'x': np.random.randn(100),
    'y': np.random.randn(100)
})

# 1행 3열이므로 1차원 배열 취급
fig, axes = plt.subplots(1, 3, figsize=(15, 5))

# 1. Matplotlib 방식
axes[0].scatter(sample_data['x'], sample_data['y'])
axes[0].set_title('Matplotlib')
axes[0].set_xlabel('X')
axes[0].set_ylabel('Y')

# 2. Pandas 방식
sample_data.plot(kind='scatter', x='x', y='y', ax=axes[1], title='Pandas')

# 3. Seaborn 방식
import seaborn as sns
sns.scatterplot(data=sample_data, x='x', y='y', ax=axes[2])
axes[2].set_title('Seaborn')

plt.tight_layout()
plt.show()
```

Pandas의 plotting 기능은 특히 **빠른 데이터 탐색**과 **프로토타이핑**에 매우 유용합니다. DataFrame에서 바로 `.plot()` 메서드를 호출할 수 있어 데이터 분석 워크플로우에서 시각화를 매우 쉽게 통합할 수 있습니다.