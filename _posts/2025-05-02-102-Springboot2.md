---
title: 7차시 9:Spring Boot2
layout: single
classes: wide
categories:
  - Spring Boot
toc: true # 이 포스트에서 목차를 활성화
toc_sticky: true # 목차를 고정할지 여부 (선택 사항)
---

# 1. Spring Boot 백엔드 연동: 

## 1. React 게시판과 연동을 위한 CRUD REST API
*   이 백엔드는 **RESTful API**를 통해 게시물(Post)과 댓글(Comment)의 CRUD를 처리합니다. 데이터베이스는 H2(인메모리 DB)를 사용해 개발/학습이 쉽도록 하며, 실제 배포 시 MySQL/PostgreSQL로 변경 가능합니다.

**주요 설계 원칙**
- **엔티티(Entity)**: JPA를 사용해 Post와 Comment를 정의. Comment는 Post와 1:N 관계(양방향 매핑).
- **리포지토리(Repository)**: Spring Data JPA의 `JpaRepository`를 상속해 CRUD 메서드를 자동 제공.
- **서비스(Service)**: 비즈니스 로직(예: 댓글 추가 시 Post 업데이트)을 처리.
- **컨트롤러(Controller)**: REST API 엔드포인트 제공 (GET/POST/PUT/DELETE).
- **React 연동 팁**: React의 `App.js`에서 `fetch`나 `axios`를 사용해 API 호출. 예: 게시물 생성 시 `POST /api/posts` 호출, 댓글 추가 시 `POST /api/posts/{postId}/comments`.
- **보안**: 사용자 인증은 React에서 세션 기반으로 처리되므로, 백엔드에서는 간단히 author 필드로 대체. 실제로는 JWT나 Spring Security 추가 추천.
- **의존성**: Spring Boot Starter Web, Spring Data JPA, H2 Database.

### 1.1 프로젝트 생성
Spring Initializr(https://start.spring.io/)에서 다음 설정으로 프로젝트 생성:
- **Project**: Maven
- **Language**: Java
- **Spring Boot**: 3.2.x (최신)
- **Dependencies**: 
  - Spring Web
  - Spring Data JPA
  - H2 Database
- **Group**: com.example
- **Artifact**: board-api


### 1.2 application.properties 
: `src/main/resources/` \
H2 DB 설정과 JPA 자동 테이블 생성을 활성화합니다.

```properties
# H2 Database 설정 (인메모리 DB, 학습용)
spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

# H2 콘솔 활성화 (브라우저에서 http://localhost:8080/h2-console 접속 가능)
spring.h2.console.enabled=true

# JPA 설정: 테이블 자동 생성, SQL 로그 출력
spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true

# 서버 포트 (React와 충돌 방지, 필요 시 변경)
server.port=8081
```

### 1.3 엔티티 클래스 
:`src/main/java/com/example/boardapi/entity/` \
JPA `@Entity`로 DB 테이블 매핑. Post와 Comment의 관계를 정의합니다.

**Post.java**
```java
package com.example.boardapi.entity;

import jakarta.persistence.*;
import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;

@Entity
@Table(name = "posts")
public class Post {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false)
    private String title;

    @Column(nullable = false, columnDefinition = "TEXT")
    private String content;

    @Column(nullable = false)
    private String author;

    @Column(nullable = false)
    private LocalDateTime createdAt;

    private LocalDateTime updatedAt;

    @OneToMany(mappedBy = "post", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<Comment> comments = new ArrayList<>();

    // 기본 생성자 (JPA 요구)
    public Post() {
        this.createdAt = LocalDateTime.now();
        this.updatedAt = LocalDateTime.now();
    }

    // 생성자
    public Post(String title, String content, String author) {
        this();
        this.title = title;
        this.content = content;
        this.author = author;
    }

    // Getter/Setter
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }

    public String getTitle() { return title; }
    public void setTitle(String title) { this.title = title; }

    public String getContent() { return content; }
    public void setContent(String content) { this.content = content; }

    public String getAuthor() { return author; }
    public void setAuthor(String author) { this.author = author; }

    public LocalDateTime getCreatedAt() { return createdAt; }
    public void setCreatedAt(LocalDateTime createdAt) { this.createdAt = createdAt; }

    public LocalDateTime getUpdatedAt() { return updatedAt; }
    public void setUpdatedAt(LocalDateTime updatedAt) { this.updatedAt = updatedAt; }

    public List<Comment> getComments() { return comments; }
    public void setComments(List<Comment> comments) { this.comments = comments; }

    // 업데이트 시 타임스탬프 갱신
    @PreUpdate
    public void preUpdate() {
        this.updatedAt = LocalDateTime.now();
    }
}
```

**Comment.java**
```java
package com.example.boardapi.entity;

import jakarta.persistence.*;
import java.time.LocalDateTime;

@Entity
@Table(name = "comments")
public class Comment {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, columnDefinition = "TEXT")
    private String content;

    @Column(nullable = false)
    private String author;

    @Column(nullable = false)
    private LocalDateTime createdAt;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "post_id", nullable = false)
    private Post post;

    // 기본 생성자
    public Comment() {
        this.createdAt = LocalDateTime.now();
    }

    // 생성자
    public Comment(String content, String author, Post post) {
        this();
        this.content = content;
        this.author = author;
        this.post = post;
    }

    // Getter/Setter
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }

    public String getContent() { return content; }
    public void setContent(String content) { this.content = content; }

    public String getAuthor() { return author; }
    public void setAuthor(String author) { this.author = author; }

    public LocalDateTime getCreatedAt() { return createdAt; }
    public void setCreatedAt(LocalDateTime createdAt) { this.createdAt = createdAt; }

    public Post getPost() { return post; }
    public void setPost(Post post) { this.post = post; }
}
```

### 1.4 리포지토리 인터페이스 
: `src/main/java/com/example/boardapi/repository/` \
`JpaRepository` 상속으로 CRUD 메서드 자동 제공 (save, findAll, findById, deleteById 등).

**PostRepository.java**
```java
package com.example.boardapi.repository;

import com.example.boardapi.entity.Post;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

@Repository
public interface PostRepository extends JpaRepository<Post, Long> {
}
```

**CommentRepository.java**
```java
package com.example.boardapi.repository;

import com.example.boardapi.entity.Comment;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface CommentRepository extends JpaRepository<Comment, Long> {
    List<Comment> findByPostId(Long postId);  // Post별 댓글 목록 조회 (커스텀 메서드)
}
```

### 1.5 서비스 클래스 
:`src/main/java/com/example/boardapi/service/` \
비즈니스 로직 처리. 예: 댓글 추가 시 Post의 comments 리스트 업데이트.

**PostService.java**
```java
package com.example.boardapi.service;

import com.example.boardapi.entity.Post;
import com.example.boardapi.repository.PostRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.Optional;

@Service
public class PostService {
    @Autowired
    private PostRepository postRepository;

    public List<Post> getAllPosts() {
        return postRepository.findAll();
    }

    public Optional<Post> getPostById(Long id) {
        return postRepository.findById(id);
    }

    public Post createPost(Post post) {
        return postRepository.save(post);
    }

    public Post updatePost(Long id, Post updatedPost) {
        return postRepository.findById(id)
                .map(post -> {
                    post.setTitle(updatedPost.getTitle());
                    post.setContent(updatedPost.getContent());
                    post.setAuthor(updatedPost.getAuthor());
                    return postRepository.save(post);
                }).orElseThrow(() -> new RuntimeException("Post not found"));
    }

    public void deletePost(Long id) {
        postRepository.deleteById(id);
    }
}
```

**CommentService.java**
```java
package com.example.boardapi.service;

import com.example.boardapi.entity.Comment;
import com.example.boardapi.entity.Post;
import com.example.boardapi.repository.CommentRepository;
import com.example.boardapi.repository.PostRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.Optional;

@Service
public class CommentService {
    @Autowired
    private CommentRepository commentRepository;
    @Autowired
    private PostRepository postRepository;

    public List<Comment> getCommentsByPostId(Long postId) {
        return commentRepository.findByPostId(postId);
    }

    public Comment createComment(Long postId, Comment comment) {
        return postRepository.findById(postId)
                .map(post -> {
                    comment.setPost(post);
                    Comment savedComment = commentRepository.save(comment);
                    post.getComments().add(savedComment);
                    postRepository.save(post);  // Post 업데이트
                    return savedComment;
                }).orElseThrow(() -> new RuntimeException("Post not found"));
    }

    public void deleteComment(Long commentId) {
        commentRepository.deleteById(commentId);
    }
}
```

### 1.6 컨트롤러 클래스 
:`src/main/java/com/example/boardapi/controller/` \
REST API 엔드포인트 정의. CORS 설정으로 React(포트 3000)에서 호출 가능.

**PostController.java**
```java
package com.example.boardapi.controller;

import com.example.boardapi.entity.Post;
import com.example.boardapi.service.PostService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/api/posts")
@CrossOrigin(origins = "http://localhost:3000")  // React 연동을 위한 CORS
public class PostController {
    @Autowired
    private PostService postService;

    @GetMapping
    public List<Post> getAllPosts() {
        return postService.getAllPosts();
    }

    @GetMapping("/{id}")
    public ResponseEntity<Post> getPostById(@PathVariable Long id) {
        return postService.getPostById(id)
                .map(post -> ResponseEntity.ok(post))
                .orElse(ResponseEntity.notFound().build());
    }

    @PostMapping
    public Post createPost(@RequestBody Post post) {
        return postService.createPost(post);
    }

    @PutMapping("/{id}")
    public ResponseEntity<Post> updatePost(@PathVariable Long id, @RequestBody Post post) {
        return ResponseEntity.ok(postService.updatePost(id, post));
    }

    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deletePost(@PathVariable Long id) {
        postService.deletePost(id);
        return ResponseEntity.noContent().build();
    }
}
```

**CommentController.java**
```java
package com.example.boardapi.controller;

import com.example.boardapi.entity.Comment;
import com.example.boardapi.service.CommentService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/api/posts/{postId}/comments")
@CrossOrigin(origins = "http://localhost:3000")
public class CommentController {
    @Autowired
    private CommentService commentService;

    @GetMapping
    public List<Comment> getComments(@PathVariable Long postId) {
        return commentService.getCommentsByPostId(postId);
    }

    @PostMapping
    public Comment createComment(@PathVariable Long postId, @RequestBody Comment comment) {
        return commentService.createComment(postId, comment);
    }

    @DeleteMapping("/{commentId}")
    public ResponseEntity<Void> deleteComment(@PathVariable Long postId, @PathVariable Long commentId) {
        commentService.deleteComment(commentId);
        return ResponseEntity.noContent().build();
    }
}
```

### 1.7 메인 애플리케이션 클래스 
: `src/main/java/com/example/boardapi/BoardApiApplication.java` \
기본 생성됨. 변경 불필요.

```java
package com.example.boardapi;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class BoardApiApplication {
    public static void main(String[] args) {
        SpringApplication.run(BoardApiApplication.class, args);
    }
}
```

### 1.8 React 연동 예시 (App.js 수정 팁)
React에서 API 호출을 위해 `useEffect`와 `fetch` 사용. 예: 게시물 목록 로드.

```javascript
// App.js에 추가 (useEffect 사용)
useEffect(() => {
  fetch('http://localhost:8081/api/posts')
    .then(res => res.json())
    .then(data => setPosts(data))
    .catch(err => console.error(err));
}, []);

// 게시물 생성 예시
const handleSubmit = () => {
  fetch('http://localhost:8081/api/posts', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ title: formData.title, content: formData.content, author: user })
  })
  .then(res => res.json())
  .then(newPost => setPosts([newPost, ...posts]))
  .catch(err => console.error(err));
};
```

댓글 추가도 유사하게 `/api/posts/{postId}/comments` 호출.

### 1.9 실행 및 테스트
1. Spring Boot 앱 실행: `mvn spring-boot:run` 또는 IDE Run.
2. H2 콘솔 확인: http://localhost:8080/h2-console (JDBC URL: jdbc:h2:mem:testdb).
3. Postman으로 테스트:
   - GET /api/posts: 목록 조회
   - POST /api/posts: { "title": "테스트", "content": "내용", "author": "user" }
   - PUT /api/posts/1: 업데이트
   - DELETE /api/posts/1: 삭제
   - 댓글: POST /api/posts/1/comments: { "content": "댓글", "author": "user" }
4. React 앱 실행: `npm start` (포트 3000), 백엔드와 연동.

### 1.10 추가 학습 팁
- **에러 처리**: `@ExceptionHandler` 추가로 404 등 처리.
- **유효성 검사**: `@Valid`와 Bean Validation (e.g., @NotBlank) 추가.
- **페이징**: `Pageable`로 게시물 목록 페이징 구현.
- **DB 변경**: application.properties에서 MySQL로 전환 (spring.datasource.url=jdbc:mysql://...).
